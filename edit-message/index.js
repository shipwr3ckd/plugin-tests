(function(u,s,n,d,R,y,c){"use strict";const C=s.findByStoreName("MessageStore"),f={};function E(e,o,a){f[`${e}_${o}`]=a}let g;function A(){g=d.instead("getMessage",C,function(e,o){const a=o(...e);if(!a)return a;const r=`${e[0]}_${e[1]}`;return f[r]?{...a,content:f[r],edited_timestamp:new Date().toISOString()}:a})}function I(){g?.()}const h=s.findByProps("openLazy","hideActionSheet"),p=s.findByProps("ActionSheetRow")?.ActionSheetRow,b=s.findByStoreName("MessageStore");let S;const v=function(e){const[o,a]=n.React.useState(e.content);return n.React.createElement(c.ModalComponent,{title:"Edit Message",onClose:function(){},footer:n.React.createElement(n.React.Fragment,null,n.React.createElement(c.ModalComponent.Cancel,{label:"Cancel"}),n.React.createElement(c.ModalComponent.Confirm,{label:"Save",onPress:function(){E(e.channel,e.id,o),c.ModalComponent.close()}}))},n.React.createElement(c.ModalComponent.TextInput,{defaultValue:e.content,multiline:!0,onChangeText:a,style:{minHeight:100}}))};function m(){S=d.after("openLazy",h,function(e){let[o,a]=e;a==="MessageLongPressActionSheet"&&o.then(function(r){return d.after("default",r,function(L,P){let[$]=L;const i=y.findInReactTree(P,function(t){return Array.isArray(t)&&t.some(function(l){return l?.type===p})});if(!i||i.some(function(t){return t?.props?.label==="Edit Message"}))return;const T=Math.max(i.findIndex(function(t){return t?.props?.label==="Reply"}),i.findIndex(function(t){return t?.props?.label==="Copy Text"}),0);i.splice(T,0,n.React.createElement(p,{label:"Edit Message",icon:n.React.createElement(p.Icon,{source:R.getAssetIDByName("ic_pencil_24px")}),onPress:function(){const{channel_id:t,id:l}=$.message,M=b.getMessage(t,l);M&&(c.openModal(function(w){return n.React.createElement(v,{channel:t,id:l,content:M.content})}),h.hideActionSheet())}}))})})})}function _(){S?.()}const x=function(){A(),m()},B=function(){_(),I()};return u.onLoad=x,u.onUnload=B,u})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.utils,vendetta.ui.modals);
