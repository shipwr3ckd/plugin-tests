(function(l,r,i,f,v,A,I,m,g){"use strict";const R=r.findByStoreName("MessageStore");r.findByProps("sendMessage","editMessage");const p=new Map;let y;function x(n,a,o){const s=`${n}:${a}`;p.set(s,o)}function B(){y=f.after("getMessages",R,function(n,a){let[o]=n;const s=a?._array??[];for(const t of s){const c=`${o}:${t.id}`;p.has(c)&&(t.content=p.get(c))}})}function C(){y?.()}function P(n){let{initialText:a,channelId:o,messageId:s}=n,t=a;I.showAlert({title:"Editing Message",content:"",extraContent:i.React.createElement(m.TextInput,{autoFocus:!0,isClearable:!0,value:t,onChange:function(c){return t=c},returnKeyType:"done",placeholder:"Edit content",style:{minHeight:100}}),actions:i.React.createElement(g.Stack,null,i.React.createElement(g.Button,{text:"Confirm",variant:"primary",onPress:function(){x(o,s,t)}}),i.React.createElement(g.Button,{text:"Cancel",variant:"secondary"}))})}const M=r.findByProps("openLazy","hideActionSheet"),h=r.findByProps("ActionSheetRow")?.ActionSheetRow,T=r.findByStoreName("MessageStore");let S;function b(){S=f.after("openLazy",M,function(n){let[a,o]=n;o==="MessageLongPressActionSheet"&&a.then(function(s){f.after("default",s,function(t,c){let[$]=t;const u=A.findInReactTree(c,function(e){return Array.isArray(e)&&e.some(function(d){return d?.type===h})});if(!u||u.some(function(e){return e?.props?.label==="Edit Message"}))return;const N=Math.max(u.findIndex(function(e){return e?.props?.label==="Reply"}),u.findIndex(function(e){return e?.props?.label==="Copy Text"}),0);u.splice(N,0,i.React.createElement(h,{label:"Edit Message",icon:i.React.createElement(h.Icon,{source:v.getAssetIDByName("ic_pencil_24px")}),onPress:function(){const{channel_id:e,id:d}=$.message,E=T.getMessage(e,d);E&&(P({initialText:E.content,channelId:e,messageId:d}),M.hideActionSheet())}}))})})})}function w(){S?.()}const L=function(){B(),b()},_=function(){w(),C()};return l.onLoad=L,l.onUnload=_,l})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.utils,vendetta.ui.alerts,vendetta.ui.components,vendetta.ui);
