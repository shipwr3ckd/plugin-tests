(function(f,o,p,d,R,_){"use strict";const b=o.findByStoreName("MessageStore"),l={};let S;function L(s,i,t){const c=`${s}_${i}`;l[c]=t}function P(){S=d.instead("getMessage",b,function(s,i){const t=i(...s);if(!t)return t;const[c,h]=s,u=`${c}_${h}`;return l[u]?{...t,content:l[u],edited_timestamp:new Date().toISOString()}:t})}function $(){S?.()}const y=o.findByProps("openLazy","hideActionSheet"),g=o.findByProps("ActionSheetRow")?.ActionSheetRow,M=o.findByStoreName("MessageStore"),N=o.findByStoreName("UserStore");let m;function U(){m=d.after("openLazy",y,function(s){let[i,t]=s;t==="MessageLongPressActionSheet"&&i.then(function(c){d.after("default",c,function(h,u){let[A]=h;const r=_.findInReactTree(u,function(e){return Array.isArray(e)&&e.some(function(n){return n?.type===g})});if(!r||r.some(function(e){return e?.props?.label==="Edit Message"}))return;const E=r.findIndex(function(e){return e?.props?.label==="Reply"}),T=E>-1?E:Math.max(r.findIndex(function(e){return e?.props?.label==="Copy Text"}),0);r.splice(T,0,p.React.createElement(g,{label:"Edit Message",icon:p.React.createElement(g.Icon,{source:R.getAssetIDByName("ic_pencil_24px")}),onPress:function(){try{const e=A?.message?.channel_id,n=A?.message?.id;if(!e||!n)return;const a=M.getMessage(e,n);if(!a)return;const v=N.getCurrentUser()?.id;if(!v)return;const I=a.author;a.author={...I,id:v};const{startEditMessage:z}=o.findByProps("startEditMessage");z(e,n);const D=setInterval(function(){const B=M.getMessage(e,n);B?.content!==a.content&&(L(e,n,B.content),clearInterval(D))},200);setTimeout(function(){a.author=I},100)}catch(e){console.error("Edit Message spoof error:",e)}finally{y.hideActionSheet()}}}))})})})}function w(){m?.()}const x=function(){P(),U()},C=function(){w(),$()};return f.onLoad=x,f.onUnload=C,f})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.utils);
