(function(_,j,G,H,O,e,X,W,r,P,F,Y,E,M,q,h,b,K,J,w,A,Z,B,V,Q){"use strict";const{ScrollView:ee}=e.ReactNative,{FormRow:te,FormSwitchRow:ne}=P.Forms;function ae(){return X.useProxy(l),React.createElement(ee,{style:{flex:1}},React.createElement(H.BetterTableRowGroup,{title:"Settings",icon:r.getAssetIDByName("CogIcon")},React.createElement(ne,{label:a.format("settings.danger_zone.title",{}),subLabel:a.format("settings.danger_zone.description",{}),leading:React.createElement(te.Icon,{source:r.getAssetIDByName("WarningIcon")}),onValueChange:function(){if(!l.dangerZone&&!O.settings.developerSettings)return W.showConfirmationAlert({title:a.format("alert.danger_zone.title",{}),content:a.format("alert.danger_zone.body",{}),confirmText:a.format("alert.danger_zone.enable",{}),onConfirm(){l.dangerZone=!0},cancelText:a.format("alert.danger_zone.cancel",{})});l.dangerZone=!l.dangerZone},value:l.dangerZone})))}var N={proxyUrl:"https://raw.githubusercontent.com/shipwr3ckd/plugin-tests/master/",customLinks:{"vendetta.nexpid.xyz":function(t){return`${J.github.url}tree/main/src/plugins/${t.join("/")}`},"mugman.catvibers.me":function(t){return`https://github.com/mugman174/${t[0]}/tree/master/plugins/${t.slice(1).join("/")}`},"plugins.obamabot.me":function(t){return`https://github.com/WolfPlugs/${t[0]}/tree/master/${t.slice(1).join("/")}`}}};function x(t){return t.endsWith("/")?t:`${t}/`}const D={origin:/^([^/]+)\/(.*)/,multiplePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*?)(?=\/)\/(.*)/,singlePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*)/,githubReleases:/^github\.com\/(.*?)(?=\/)\/(.*?)(?=\/)\/releases/};function ie(t){const n=t.match(D.multiplePluginGitio);if(n?.[0])return`https://github.com/${n[1]}/${n[2]}/tree/master/plugins/${n[3]}`;const u=t.match(D.singlePluginGitio)??t.match(D.githubReleases);if(u?.[0])return`https://github.com/${u[1]}/${u[2]}`;const[o,c,p]=t.match(D.origin);if(N.customLinks[c])return N.customLinks[c](p.split("/"))}let T=new Array;function z(){return!T[0]||!l.pluginCache[0]?[]:T.filter(function(t){return!l.pluginCache.includes(t)})}function re(){l.pluginCache=T}async function $(t){T=(t??await(await M.safeFetch(`${N.proxyUrl}plugins.json`,{cache:"no-store"})).json()).map(function(n){return x(typeof n=="string"?n:n.vendetta.original)})}function oe(){const t=setInterval($,36e5);return $(),function(){clearInterval(t)}}const{FormRow:le}=P.Forms,k=e.stylesheet.createThemedStyleSheet({card:{padding:16,borderRadius:16,borderColor:A.semanticColors.BORDER_FAINT,borderWidth:1,backgroundColor:A.semanticColors.CARD_PRIMARY_BG},content:{flexDirection:"row",alignItems:"center",flex:1},title:{flexDirection:"row",alignItems:"center",gap:6,flexShrink:1},pluginIcon:{tintColor:A.semanticColors.LOGO_PRIMARY,width:18,height:18},actions:{flexDirection:"row-reverse",alignItems:"center",gap:5}});function ce(t){const n=k.card.backgroundColor,u=V.lerp(n,A.rawColors.BRAND_500,.08),o=h.Reanimated.useSharedValue(n);return e.React.useEffect(function(){o.value=n,t.highlight&&(o.value=h.Reanimated.withSequence(h.Reanimated.withTiming(u,{duration:500,easing:h.Reanimated.Easing.cubic}),h.Reanimated.withTiming(n,{duration:500,easing:h.Reanimated.Easing.cubic})))},[t.highlight]),e.React.createElement(h.Reanimated.default.View,{style:[k.card,{backgroundColor:o},t.disabled&&{opacity:.5}]},e.React.createElement(b.Stack,{spacing:16},e.React.createElement(e.ReactNative.View,{style:k.content},e.React.createElement(b.Stack,{spacing:0,style:{flex:1}},e.React.createElement(e.ReactNative.View,{style:k.title},t.headerIcon&&e.React.createElement(e.ReactNative.Image,{style:k.pluginIcon,resizeMode:"cover",source:t.headerIcon}),e.React.createElement(B,{variant:"heading-lg/semibold",color:"HEADER_PRIMARY",lineClamp:1,ellipsis:"tail",style:{flexShrink:1}},t.headerLabel),t.headerSuffix),t.headerSublabel&&e.React.createElement(B,{variant:"text-md/semibold",color:"TEXT_MUTED"},t.headerSublabel)),e.React.createElement(e.ReactNative.View,null,e.React.createElement(b.Stack,{spacing:5,direction:"horizontal"},t.actions?.map(function(c){let{icon:p,onPress:R,isDestructive:m,loading:v,disabled:i}=c;return e.React.createElement(b.IconButton,{onPress:R,disabled:i,loading:v,size:"sm",variant:m?"destructive":"secondary",icon:r.getAssetIDByName(p)})}),t.overflowActions&&e.React.createElement(b.IconButton,{onPress:function(){Z.showSimpleActionSheet({key:"CardOverflow",header:{title:t.overflowTitle,icon:t.headerIcon&&t.headerIcon&&e.React.createElement(le.Icon,{source:t.headerIcon}),onClose:Z.hideActionSheet},options:t.overflowActions?.map(function(c){return{...c,icon:r.getAssetIDByName(c.icon)}})})},size:"sm",variant:"secondary",icon:r.getAssetIDByName("CircleInformationIcon-primary")})))),t.descriptionLabel&&e.React.createElement(B,{variant:"text-md/medium",color:"TEXT_NORMAL"},t.descriptionLabel)))}function se(t){let{item:n,changes:u}=t;const{usableLink:o,trueLink:c,proxiedLink:p,githubLink:R}=e.React.useMemo(function(){const f=n.vendetta.original,s=`https://${f.replace(/^vendetta\.nexpid\.xyz\//,"revenge.nexpid.xyz/")}`,g=`${N.proxyUrl}${f}`;let y=l.dangerZone?s:g;return!l.dangerZone&&w.plugins[s]&&(y=s),{usableLink:y,trueLink:s,proxiedLink:g,githubLink:ie(n.vendetta.original)}},[n]),m=e.React.useMemo(function(){return u.includes(x(n.vendetta.original))},[u,n]),v=!!n.bunny?.disabled,[i,S]=e.React.useState({hasPlugin:!!w.plugins[o],pending:!1});e.React.useEffect(function(){S({hasPlugin:!!w.plugins[o],pending:!1})},[n]);const L=async function(){if(i.pending||v)return;S({hasPlugin:!!w.plugins[o],pending:!0});const f=!!w.plugins[o];try{f?w.removePlugin(o):await w.installPlugin(o)}catch{E.showToast(a.format(f?"toast.plugin.delete.fail":"toast.plugin.install.fail",{plugin:n.name}),r.getAssetIDByName("CircleXIcon-primary"))}E.showToast(a.format(f?"toast.plugin.delete.success":"toast.plugin.install.success",{plugin:n.name}),r.getAssetIDByName(f?"TrashIcon":"DownloadIcon")),S({hasPlugin:!!w.plugins[o],pending:!1})};return e.React.createElement(ce,{headerLabel:n.name,headerSuffix:m&&e.React.createElement(F,{variant:"primary",style:{marginLeft:4},shiny:!0},a.format("browser.plugin.new",{})),highlight:!!m,headerSublabel:n.authors[0]&&`by ${n.authors.map(function(f){return f.name}).join(", ")}`,headerIcon:r.getAssetIDByName(n.vendetta.icon??""),descriptionLabel:n.description,overflowTitle:n.name,actions:v?[]:[{icon:i.hasPlugin?"TrashIcon":"DownloadIcon",disabled:i.pending,loading:i.pending,isDestructive:i.hasPlugin,onPress:L}],overflowActions:[...v?[]:[{label:a.format(i.hasPlugin?"sheet.plugin.uninstall":"sheet.plugin.install",{}),icon:i.hasPlugin?"TrashIcon":"DownloadIcon",isDestructive:i.hasPlugin,onPress:L}],{label:a.format("sheet.plugin.copy_plugin_link",{}),icon:"CopyIcon",onPress:function(){E.showToast(a.format("toast.copy_link",{}),r.getAssetIDByName("CopyIcon")),e.clipboard.setString(o)}},{label:a.format(l.dangerZone?"sheet.plugin.copy_proxied_link":"sheet.plugin.copy_unproxied_link",{}),icon:"CopyIcon",onPress:function(){E.showToast(a.format("toast.copy_link",{}),r.getAssetIDByName("CopyIcon")),e.clipboard.setString(l.dangerZone?p:c)}},...R?[{label:a.format("sheet.plugin.open_github",{}),icon:"img_account_sync_github_white",onPress:async function(){if(E.showToast(a.format("toast.open_link",{}),r.getAssetIDByName("LinkExternalSmallIcon")),await e.ReactNative.Linking.canOpenURL("https://github.com")){const{url:f}=await fetch(R,{redirect:"follow"});e.ReactNative.Linking.openURL(f)}else e.url.openURL(R)}}]:[]],disabled:v})}var ue="4e4bdb9f9a50874b.png",ge="10f7b6af6da32586.png",fe="ebdfb66d2006204e.png",de="d9cbba0c467c3f71.png";function he(){return e.React.createElement(e.ReactNative.Image,{style:{width:16,height:16,tintColor:V.resolveSemanticColor(A.semanticColors.INTERACTIVE_NORMAL)},source:r.getAssetIDByName("search")})}function pe(t){let{onChangeText:n,filterSetSort:u,inputRef:o}=t;const[c,p]=e.React.useState(""),[R,m]=e.React.useState(!1),v=function(i){p(i),n(i)};return e.React.createElement(P.ErrorBoundary,null,e.React.createElement(e.ReactNative.View,{style:{flexDirection:"row",justifyContent:"center",gap:8,marginBottom:5}},e.React.createElement(e.ReactNative.View,{style:{flexGrow:1}},e.React.createElement(b.TextInput,{grow:!0,isClearable:!0,leadingIcon:he,placeholder:Q.SEARCH,onChange:v,returnKeyType:"search",size:"md",autoCapitalize:"none",autoCorrect:!1,value:c,isRound:!0,onFocus:function(){return m(!0)},onBlur:function(){return m(!1)},ref:o})),!R&&!c&&e.React.createElement(b.ContextMenu,{title:a.format("sheet.sort.title",{}),items:Object.values(Re).map(function(i){return{label:a.format(i,{}),variant:"default",action:function(){return u.current(i)},iconSource:{"sheet.sort.date_newest":ue,"sheet.sort.date_oldest":ge,"sheet.sort.name_az":fe,"sheet.sort.name_za":de}[i]}})},function(i){return e.React.createElement(b.IconButton,{icon:r.getAssetIDByName("FiltersHorizontalIcon"),size:"md",variant:"tertiary",...i})})))}var Re=function(t){return t.DateNewest="sheet.sort.date_newest",t.DateOldest="sheet.sort.date_oldest",t.NameAZ="sheet.sort.name_az",t.NameZA="sheet.sort.name_za",t}({});const me=h.Reanimated.default.createAnimatedComponent(b.IconButton);function ve(){const[t,n]=e.React.useState(null),[u,o]=e.React.useState(""),[c,p]=e.React.useState("sheet.sort.date_newest"),R=e.React.useRef(p);R.current=p;const m=e.React.useRef(z()),v=e.React.useRef(),i=e.React.useRef(),[S,L]=e.React.useState(!1),f=e.React.useMemo(function(){if(!t)return[];if(u)return q.go(u,t,{keys:["vendetta.original","name","description","authors.0.name","authors.1.name","authors.2.name"]}).map(function(g){return g.obj});let s=t.slice();return["sheet.sort.name_az","sheet.sort.name_za"].includes(c)&&(s=s.sort(function(g,y){return g.name<y.name?-1:g.name>y.name?1:0})),["sheet.sort.name_za","sheet.sort.date_newest"].includes(c)&&s.reverse(),s},[c,t,u]);return e.React.useEffect(function(){return function(){re()}},[]),e.React.useEffect(function(){t||M.safeFetch(`${N.proxyUrl}plugins-full.json`,{cache:"no-store"}).then(function(s){return s.json().then(function(g){return g.map(function(y){return{...y,vendetta:{...y.vendetta,original:x(y.vendetta.original)}}})}).then(function(g){$(g),m.current=z(),n(g)}).catch(function(){E.showToast(a.format("toast.data.fail_parse",{}),r.getAssetIDByName("CircleXIcon-primary"))})}).catch(function(){E.showToast(a.format("toast.data.fail_fetch",{}),r.getAssetIDByName("CircleXIcon-primary"))})},[t]),K.managePage({title:a.format("plugin.name",{}),headerRight:function(){return S?e.React.createElement(me,{icon:r.getAssetIDByName("ArrowSmallUpIcon"),variant:"secondary",size:"sm",onPress:function(){return v.current?.scrollToOffset({animated:!0,offset:0}),i.current?.focus()},entering:h.Reanimated.FadeIn.duration(200),exiting:h.Reanimated.FadeOut.duration(200)}):null}},null,[S]),e.React.createElement(h.FlashList,{ListHeaderComponent:e.React.createElement(pe,{onChangeText:o,filterSetSort:R,inputRef:i}),ItemSeparatorComponent:function(){return e.React.createElement(e.ReactNative.View,{style:{height:8}})},contentContainerStyle:{paddingHorizontal:10},data:f,estimatedItemSize:113,renderItem:function(s){let{item:g}=s;return e.React.createElement(se,{item:g,changes:m.current})},removeClippedSubviews:!0,refreshControl:e.React.createElement(e.ReactNative.RefreshControl,{refreshing:t===null,onRefresh:function(){return t!==null&&n(null)}}),onScroll:function(s){return L(s.nativeEvent.contentOffset.y>=45)}})}function be(){const t=new Array;return t.push(Y.patchSettingsPin({key:O.plugin.manifest.name,icon:r.getAssetIDByName(j.manifest.vendetta?.icon??""),trailing:function(){const n=e.React.useRef(Object.keys(z()).length).current;if(n>0)return e.React.createElement(F,{variant:"danger"},n)},title:function(){return a.format("plugin.name",{})},predicate:function(){return!0},page:ve})),t.push(oe()),t.push(a.unload),function(){for(const n of t)n()}}const l=j.storage,a=new G.Lang("plugin_browser");let U;var ye={onLoad:function(){l.pluginCache??=[],l.dangerZone??=!1,U=be()},onUnload:function(){return U?.()},settings:ae};return _.default=ye,_.lang=a,_.vstorage=l,Object.defineProperty(_,"__esModule",{value:!0}),_})({},vendetta.plugin,lang$1,BetterTableRow,vendetta,vendetta.metro.common,vendetta.storage,vendetta.ui.alerts,vendetta.ui.assets,vendetta.ui.components,C,pinToSettings,vendetta.ui.toasts,vendetta.utils,I,deps,redesign,ui$1,n$1,vendetta.plugins,vendetta.ui,ActionSheet,d,types,S$1);
