(function(_,j,G,Z,e,H,r,T,X,O,W,E,F,Y,h,b,q,K,w,A,M,B,V,J){"use strict";const{ScrollView:Q}=e.ReactNative,{FormRow:ee,FormSwitchRow:te}=T.Forms;function ne(){return H.useProxy(f),f.dangerZone=!0,React.createElement(Q,{style:{flex:1}},React.createElement(Z.BetterTableRowGroup,{title:"Settings",icon:r.getAssetIDByName("CogIcon")},React.createElement(te,{label:"placeholder",subLabel:i.format("settings.danger_zone.description",{}),leading:React.createElement(ee.Icon,{source:r.getAssetIDByName("WarningIcon")}),onValueChange:function(){},value:!0})))}var N={proxyUrl:"https://raw.githubusercontent.com/shipwr3ckd/plugin-tests/master/",customLinks:{"vendetta.nexpid.xyz":function(t){return`${K.github.url}tree/main/src/plugins/${t.join("/")}`},"mugman.catvibers.me":function(t){return`https://github.com/mugman174/${t[0]}/tree/master/plugins/${t.slice(1).join("/")}`},"plugins.obamabot.me":function(t){return`https://github.com/WolfPlugs/${t[0]}/tree/master/${t.slice(1).join("/")}`}}};function D(t){return t.endsWith("/")?t:`${t}/`}const x={origin:/^([^/]+)\/(.*)/,multiplePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*?)(?=\/)\/(.*)/,singlePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*)/,githubReleases:/^github\.com\/(.*?)(?=\/)\/(.*?)(?=\/)\/releases/};function ae(t){const n=t.match(x.multiplePluginGitio);if(n?.[0])return`https://github.com/${n[1]}/${n[2]}/tree/master/plugins/${n[3]}`;const s=t.match(x.singlePluginGitio)??t.match(x.githubReleases);if(s?.[0])return`https://github.com/${s[1]}/${s[2]}`;const[o,l,p]=t.match(x.origin);if(N.customLinks[l])return N.customLinks[l](p.split("/"))}let L=new Array;function $(){return!L[0]||!f.pluginCache[0]?[]:L.filter(function(t){return!f.pluginCache.includes(t)})}function ie(){f.pluginCache=L}async function z(t){L=(t??await(await F.safeFetch(`${N.proxyUrl}plugins.json`,{cache:"no-store"})).json()).map(function(n){return D(typeof n=="string"?n:n.vendetta.original)})}function re(){const t=setInterval(z,36e5);return z(),function(){clearInterval(t)}}const{FormRow:oe}=T.Forms,k=e.stylesheet.createThemedStyleSheet({card:{padding:16,borderRadius:16,borderColor:A.semanticColors.BORDER_FAINT,borderWidth:1,backgroundColor:A.semanticColors.CARD_PRIMARY_BG},content:{flexDirection:"row",alignItems:"center",flex:1},title:{flexDirection:"row",alignItems:"center",gap:6,flexShrink:1},pluginIcon:{tintColor:A.semanticColors.LOGO_PRIMARY,width:18,height:18},actions:{flexDirection:"row-reverse",alignItems:"center",gap:5}});function le(t){const n=k.card.backgroundColor,s=V.lerp(n,A.rawColors.BRAND_500,.08),o=h.Reanimated.useSharedValue(n);return e.React.useEffect(function(){o.value=n,t.highlight&&(o.value=h.Reanimated.withSequence(h.Reanimated.withTiming(s,{duration:500,easing:h.Reanimated.Easing.cubic}),h.Reanimated.withTiming(n,{duration:500,easing:h.Reanimated.Easing.cubic})))},[t.highlight]),e.React.createElement(h.Reanimated.default.View,{style:[k.card,{backgroundColor:o},t.disabled&&{opacity:.5}]},e.React.createElement(b.Stack,{spacing:16},e.React.createElement(e.ReactNative.View,{style:k.content},e.React.createElement(b.Stack,{spacing:0,style:{flex:1}},e.React.createElement(e.ReactNative.View,{style:k.title},t.headerIcon&&e.React.createElement(e.ReactNative.Image,{style:k.pluginIcon,resizeMode:"cover",source:t.headerIcon}),e.React.createElement(B,{variant:"heading-lg/semibold",color:"HEADER_PRIMARY",lineClamp:1,ellipsis:"tail",style:{flexShrink:1}},t.headerLabel),t.headerSuffix),t.headerSublabel&&e.React.createElement(B,{variant:"text-md/semibold",color:"TEXT_MUTED"},t.headerSublabel)),e.React.createElement(e.ReactNative.View,null,e.React.createElement(b.Stack,{spacing:5,direction:"horizontal"},t.actions?.map(function(l){let{icon:p,onPress:R,isDestructive:v,loading:y,disabled:a}=l;return e.React.createElement(b.IconButton,{onPress:R,disabled:a,loading:y,size:"sm",variant:v?"destructive":"secondary",icon:r.getAssetIDByName(p)})}),t.overflowActions&&e.React.createElement(b.IconButton,{onPress:function(){M.showSimpleActionSheet({key:"CardOverflow",header:{title:t.overflowTitle,icon:t.headerIcon&&t.headerIcon&&e.React.createElement(oe.Icon,{source:t.headerIcon}),onClose:M.hideActionSheet},options:t.overflowActions?.map(function(l){return{...l,icon:r.getAssetIDByName(l.icon)}})})},size:"sm",variant:"secondary",icon:r.getAssetIDByName("CircleInformationIcon-primary")})))),t.descriptionLabel&&e.React.createElement(B,{variant:"text-md/medium",color:"TEXT_NORMAL"},t.descriptionLabel)))}function ce(t){let{item:n,changes:s}=t;const{usableLink:o,trueLink:l,proxiedLink:p,githubLink:R}=e.React.useMemo(function(){const g=n.vendetta.original,c=`https://${g.replace(/^vendetta\.nexpid\.xyz\//,"revenge.nexpid.xyz/")}`,u=`${N.proxyUrl}${g}`;let m=f.dangerZone?c:u;return!f.dangerZone&&w.plugins[c]&&(m=c),{usableLink:m,trueLink:c,proxiedLink:u,githubLink:ae(n.vendetta.original)}},[n]),v=e.React.useMemo(function(){return s.includes(D(n.vendetta.original))},[s,n]),y=!!n.bunny?.disabled,[a,S]=e.React.useState({hasPlugin:!!w.plugins[o],pending:!1});e.React.useEffect(function(){S({hasPlugin:!!w.plugins[o],pending:!1})},[n]);const P=async function(){if(a.pending||y)return;S({hasPlugin:!!w.plugins[o],pending:!0});const g=!!w.plugins[o];try{g?w.removePlugin(o):await w.installPlugin(o)}catch{E.showToast(i.format(g?"toast.plugin.delete.fail":"toast.plugin.install.fail",{plugin:n.name}),r.getAssetIDByName("CircleXIcon-primary"))}E.showToast(i.format(g?"toast.plugin.delete.success":"toast.plugin.install.success",{plugin:n.name}),r.getAssetIDByName(g?"TrashIcon":"DownloadIcon")),S({hasPlugin:!!w.plugins[o],pending:!1})};return e.React.createElement(le,{headerLabel:n.name,headerSuffix:v&&e.React.createElement(O,{variant:"primary",style:{marginLeft:4},shiny:!0},i.format("browser.plugin.new",{})),highlight:!!v,headerSublabel:n.authors[0]&&`by ${n.authors.map(function(g){return g.name}).join(", ")}`,headerIcon:r.getAssetIDByName(n.vendetta.icon??""),descriptionLabel:n.description,overflowTitle:n.name,actions:y?[]:[{icon:a.hasPlugin?"TrashIcon":"DownloadIcon",disabled:a.pending,loading:a.pending,isDestructive:a.hasPlugin,onPress:P}],overflowActions:[...y?[]:[{label:i.format(a.hasPlugin?"sheet.plugin.uninstall":"sheet.plugin.install",{}),icon:a.hasPlugin?"TrashIcon":"DownloadIcon",isDestructive:a.hasPlugin,onPress:P}],{label:i.format("sheet.plugin.copy_plugin_link",{}),icon:"CopyIcon",onPress:function(){E.showToast(i.format("toast.copy_link",{}),r.getAssetIDByName("CopyIcon")),e.clipboard.setString(o)}},{label:i.format(f.dangerZone?"sheet.plugin.copy_proxied_link":"sheet.plugin.copy_unproxied_link",{}),icon:"CopyIcon",onPress:function(){E.showToast(i.format("toast.copy_link",{}),r.getAssetIDByName("CopyIcon")),e.clipboard.setString(f.dangerZone?p:l)}},...R?[{label:i.format("sheet.plugin.open_github",{}),icon:"img_account_sync_github_white",onPress:async function(){if(E.showToast(i.format("toast.open_link",{}),r.getAssetIDByName("LinkExternalSmallIcon")),await e.ReactNative.Linking.canOpenURL("https://github.com")){const{url:g}=await fetch(R,{redirect:"follow"});e.ReactNative.Linking.openURL(g)}else e.url.openURL(R)}}]:[]],disabled:y})}var se="4e4bdb9f9a50874b.png",ue="10f7b6af6da32586.png",ge="ebdfb66d2006204e.png",fe="d9cbba0c467c3f71.png";function de(){return e.React.createElement(e.ReactNative.Image,{style:{width:16,height:16,tintColor:V.resolveSemanticColor(A.semanticColors.INTERACTIVE_NORMAL)},source:r.getAssetIDByName("search")})}function he(t){let{onChangeText:n,filterSetSort:s,inputRef:o}=t;const[l,p]=e.React.useState(""),[R,v]=e.React.useState(!1),y=function(a){p(a),n(a)};return e.React.createElement(T.ErrorBoundary,null,e.React.createElement(e.ReactNative.View,{style:{flexDirection:"row",justifyContent:"center",gap:8,marginBottom:5}},e.React.createElement(e.ReactNative.View,{style:{flexGrow:1}},e.React.createElement(b.TextInput,{grow:!0,isClearable:!0,leadingIcon:de,placeholder:J.SEARCH,onChange:y,returnKeyType:"search",size:"md",autoCapitalize:"none",autoCorrect:!1,value:l,isRound:!0,onFocus:function(){return v(!0)},onBlur:function(){return v(!1)},ref:o})),!R&&!l&&e.React.createElement(b.ContextMenu,{title:i.format("sheet.sort.title",{}),items:Object.values(pe).map(function(a){return{label:i.format(a,{}),variant:"default",action:function(){return s.current(a)},iconSource:{"sheet.sort.date_newest":se,"sheet.sort.date_oldest":ue,"sheet.sort.name_az":ge,"sheet.sort.name_za":fe}[a]}})},function(a){return e.React.createElement(b.IconButton,{icon:r.getAssetIDByName("FiltersHorizontalIcon"),size:"md",variant:"tertiary",...a})})))}var pe=function(t){return t.DateNewest="sheet.sort.date_newest",t.DateOldest="sheet.sort.date_oldest",t.NameAZ="sheet.sort.name_az",t.NameZA="sheet.sort.name_za",t}({});const Re=h.Reanimated.default.createAnimatedComponent(b.IconButton);function ve(){const[t,n]=e.React.useState(null),[s,o]=e.React.useState(""),[l,p]=e.React.useState("sheet.sort.date_newest"),R=e.React.useRef(p);R.current=p;const v=e.React.useRef($()),y=e.React.useRef(),a=e.React.useRef(),[S,P]=e.React.useState(!1),g=e.React.useMemo(function(){if(!t)return[];if(s)return Y.go(s,t,{keys:["vendetta.original","name","description","authors.0.name","authors.1.name","authors.2.name"]}).map(function(u){return u.obj});let c=t.slice();return["sheet.sort.name_az","sheet.sort.name_za"].includes(l)&&(c=c.sort(function(u,m){return u.name<m.name?-1:u.name>m.name?1:0})),["sheet.sort.name_za","sheet.sort.date_newest"].includes(l)&&c.reverse(),c},[l,t,s]);return e.React.useEffect(function(){return function(){ie()}},[]),e.React.useEffect(function(){t||F.safeFetch(`${N.proxyUrl}plugins-full.json`,{cache:"no-store"}).then(function(c){return c.json().then(function(u){return u.map(function(m){return{...m,vendetta:{...m.vendetta,original:D(m.vendetta.original)}}})}).then(function(u){z(u),v.current=$(),n(u)}).catch(function(){E.showToast(i.format("toast.data.fail_parse",{}),r.getAssetIDByName("CircleXIcon-primary"))})}).catch(function(){E.showToast(i.format("toast.data.fail_fetch",{}),r.getAssetIDByName("CircleXIcon-primary"))})},[t]),q.managePage({title:i.format("plugin.name",{}),headerRight:function(){return S?e.React.createElement(Re,{icon:r.getAssetIDByName("ArrowSmallUpIcon"),variant:"secondary",size:"sm",onPress:function(){return y.current?.scrollToOffset({animated:!0,offset:0}),a.current?.focus()},entering:h.Reanimated.FadeIn.duration(200),exiting:h.Reanimated.FadeOut.duration(200)}):null}},null,[S]),e.React.createElement(h.FlashList,{ListHeaderComponent:e.React.createElement(he,{onChangeText:o,filterSetSort:R,inputRef:a}),ItemSeparatorComponent:function(){return e.React.createElement(e.ReactNative.View,{style:{height:8}})},contentContainerStyle:{paddingHorizontal:10},data:g,estimatedItemSize:113,renderItem:function(c){let{item:u}=c;return e.React.createElement(ce,{item:u,changes:v.current})},removeClippedSubviews:!0,refreshControl:e.React.createElement(e.ReactNative.RefreshControl,{refreshing:t===null,onRefresh:function(){return t!==null&&n(null)}}),onScroll:function(c){return P(c.nativeEvent.contentOffset.y>=45)}})}function ye(){const t=new Array;return t.push(W.patchSettingsPin({key:X.plugin.manifest.name,icon:r.getAssetIDByName(j.manifest.vendetta?.icon??""),trailing:function(){const n=e.React.useRef(Object.keys($()).length).current;if(n>0)return e.React.createElement(O,{variant:"danger"},n)},title:function(){return i.format("plugin.name",{})},predicate:function(){return!0},page:ve})),t.push(re()),t.push(i.unload),function(){for(const n of t)n()}}const f=j.storage,i=new G.Lang("plugin_browser");let U;var be={onLoad:function(){f.pluginCache??=[],f.dangerZone??=!1,U=ye()},onUnload:function(){return U?.()},settings:ne};return _.default=be,_.lang=i,_.vstorage=f,Object.defineProperty(_,"__esModule",{value:!0}),_})({},vendetta.plugin,lang$1,BetterTableRow,vendetta.metro.common,vendetta.storage,vendetta.ui.assets,vendetta.ui.components,vendetta,C,pinToSettings,vendetta.ui.toasts,vendetta.utils,I,deps,redesign,ui$1,n$1,vendetta.plugins,vendetta.ui,ActionSheet,d,types,S$1);
