(function(C,f,a,i,g,u,E,v,_){"use strict";const{Permissions:A}=i.constants,{computePermissions:R}=a.findByProps("computePermissions","canEveryoneRole"),y=a.findByStoreName("GuildMemberStore"),B=[i.i18n.Messages.AI_TAG,i.i18n.Messages.BOT_TAG_SERVER,i.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,i.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,i.i18n.Messages.REMIXING_TAG],M=[{text:"WEBHOOK",condition:function(t,o,e){return e.isNonUserBot()}},{text:"OWNER",backgroundColor:u.rawColors.ORANGE_345,condition:function(t,o,e){return t?.ownerId===e.id}},{text:i.i18n.Messages.BOT_TAG_BOT,condition:function(t,o,e){return e.bot},verified:function(t,o,e){return e.isVerifiedBot()}},{text:"ADMIN",backgroundColor:u.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:u.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:u.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function N(t,o,e){let s;if(t){const n=R({user:e,context:t,overwrites:o?.permissionOverwrites});s=Object.entries(A).map(function(r){let[l,c]=r;return n&c?l:""}).filter(Boolean)}for(const n of M)if(n.condition?.(t,o,e)||n.permissions?.some(function(r){return s?.includes(r)})){let r=f.storage.useRoleColor?y.getMember(t?.id,e.id)?.colorString:void 0,l=r||(n.backgroundColor??u.rawColors.BRAND_500),c=r||!n.textColor?i.chroma(l).get("lab.l")<70?u.rawColors.WHITE_500:u.rawColors.BLACK_500:n.textColor;return{...n,textColor:c,backgroundColor:l,verified:typeof n.verified=="function"?n.verified(t,o,e):n.verified??!1,condition:void 0,permissions:void 0}}}const T=a.findByName("getTagProperties",!1),h=a.findByStoreName("GuildStore"),x=a.findByStoreName("ChannelStore");function G(){return g.after("default",T,function(t,o){let[{message:e}]=t;if(!B.includes(o.tagText)){const s=x.getChannel(e.channel_id),n=h.getGuild(s?.guild_id),r=N(n,s,e.author);if(r)return{...o,tagText:r.text,tagTextColor:r.textColor?i.ReactNative.processColor(i.chroma(r.textColor).hex()):void 0,tagBackgroundColor:r.backgroundColor?i.ReactNative.processColor(i.chroma(r.backgroundColor).hex()):void 0,tagVerified:r.verified,tagType:void 0}}})}const b=a.findByName("DisplayName",!1),I=a.findByName("HeaderName",!1),S=a.findByProps("getBotLabel"),O=S.getBotLabel,k=a.findByStoreName("GuildStore"),w=a.findByStoreName("ChannelStore");function m(){const t=[];return t.push(g.after("default",I,function(o,e){let[{channelId:s}]=o;e.props.channelId=s})),t.push(g.after("default",b,function(o,e){let[{guildId:s,channelId:n,user:r}]=o;if(!e)return;const l=E.findInReactTree(e,function(c){return c?.type?.Types});if(!l||!B.includes(O(l.props.type))){const c=k.getGuild(s),V=w.getChannel(n),d=N(c,V,r);d&&(l?l.props={type:0,...d}:E.findInReactTree(e,function(W){return W.props.style.flexDirection==="row"}).props.children.push(React.createElement(S.default,{style:{marginLeft:0},type:0,text:d.text,textColor:d.textColor,backgroundColor:d.backgroundColor,verified:d.verified})))}})),function(){return t.forEach(function(o){return o()})}}const D=a.findByProps("getBotLabel");function L(){return g.after("default",D,function(t,o){let[{text:e,textColor:s,backgroundColor:n}]=t;if(!o)return;const r=E.findInReactTree(o,function(l){return typeof l?.props?.children=="string"});e&&(r.props.children=e),s&&r.props.style.push({color:s}),n&&o.props.style.push({backgroundColor:n})})}const{ScrollView:P}=_.General,{FormSection:U,FormSwitchRow:$}=_.Forms;function H(){return v.useProxy(f.storage),React.createElement(P,{style:{flex:1}},React.createElement(U,{title:"Tag style"},React.createElement($,{label:"Use top role color for tag backgrounds",value:f.storage.useRoleColor,onValueChange:function(t){f.storage.useRoleColor=t}})))}let p=[];var K={onLoad:function(){f.storage.useRoleColor??=!1,p.push(G()),p.push(L()),p.push(m())},onUnload:function(){return p.forEach(function(t){return t()})},settings:H};return C.default=K,Object.defineProperty(C,"__esModule",{value:!0}),C})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
