(function(d,u,l,s,C,a,_,A,E){"use strict";const{Permissions:M}=s.constants,{computePermissions:v}=l.findByProps("computePermissions","canEveryoneRole"),p=l.findByStoreName("GuildMemberStore"),R=[s.i18n.Messages.AI_TAG,s.i18n.Messages.BOT_TAG_SERVER,s.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,s.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,s.i18n.Messages.REMIXING_TAG],S=[{text:"WEBHOOK",condition:function(e,n,t){return t.isNonUserBot()}},{text:"OWNER",backgroundColor:a.rawColors.ORANGE_345,condition:function(e,n,t){return e?.ownerId===t.id}},{text:s.i18n.Messages.BOT_TAG_BOT,condition:function(e,n,t){return t.bot},verified:function(e,n,t){return t.isVerifiedBot()}},{text:"ADMIN",backgroundColor:a.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:a.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:a.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function T(e,n,t){let i;if(e){const r=v({user:t,context:e,overwrites:n?.permissionOverwrites});i=Object.entries(M).map(function(o){let[c,g]=o;return r&g?c:""}).filter(Boolean)}for(const r of S)if(r.condition?.(e,n,t)||r.permissions?.some(function(o){return i?.includes(o)})){let o=u.storage.useRoleColor?p.getMember(e?.id,t.id)?.colorString:void 0,c=o||(r.backgroundColor??a.rawColors.BRAND_500),g=o||!r.textColor?s.chroma(c).get("lab.l")<70?a.rawColors.WHITE_500:a.rawColors.BLACK_500:r.textColor;return{...r,textColor:g,backgroundColor:c,verified:typeof r.verified=="function"?r.verified(e,n,t):r.verified??!1,condition:void 0,permissions:void 0}}}const B=l.findByName("getTagProperties",!1),G=l.findByStoreName("GuildStore"),N=l.findByStoreName("ChannelStore");function x(){return C.after("default",B,function(e,n){let[{message:t}]=e;if(!R.includes(n.tagText)){const i=N.getChannel(t.channel_id),r=G.getGuild(i?.guild_id),o=T(r,i,t.author);if(o)return{...n,tagText:o.text,tagTextColor:o.textColor?s.ReactNative.processColor(s.chroma(o.textColor).hex()):void 0,tagBackgroundColor:o.backgroundColor?s.ReactNative.processColor(s.chroma(o.backgroundColor).hex()):void 0,tagVerified:o.verified,tagType:void 0}}})}const b=l.findByProps("getBotLabel");function h(){return C.after("default",b,function(e,n){let[{text:t,textColor:i,backgroundColor:r}]=e;if(!n)return;const o=_.findInReactTree(n,function(c){return typeof c?.props?.children=="string"});t&&(o.props.children=t),i&&o.props.style.push({color:i}),r&&n.props.style.push({backgroundColor:r})})}const{ScrollView:O}=E.General,{FormSection:y,FormSwitchRow:I}=E.Forms;function w(){return A.useProxy(u.storage),React.createElement(O,{style:{flex:1}},React.createElement(y,{title:"Tag style"},React.createElement(I,{label:"Use top role color for tag backgrounds",value:u.storage.useRoleColor,onValueChange:function(e){u.storage.useRoleColor=e}})))}let f=[];var k={onLoad:function(){u.storage.useRoleColor??=!1,f.push(x())/f.push(h())},onUnload:function(){return f.forEach(function(e){return e()})},settings:w};return d.default=k,Object.defineProperty(d,"__esModule",{value:!0}),d})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
