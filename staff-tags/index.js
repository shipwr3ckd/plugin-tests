(function(R,C,s,u,f,c,d,S,b){"use strict";const{Permissions:T}=u.constants,{computePermissions:N}=s.findByProps("computePermissions","canEveryoneRole"),_=s.findByStoreName("GuildMemberStore"),E=[u.i18n.Messages.AI_TAG,u.i18n.Messages.BOT_TAG_SERVER,u.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,u.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,u.i18n.Messages.REMIXING_TAG],G=[{text:"WEBHOOK",condition:function(t,e,r){return r.isNonUserBot()}},{text:"OWNER",backgroundColor:c.rawColors.ORANGE_345,condition:function(t,e,r){return t?.ownerId===r.id}},{text:u.i18n.Messages.BOT_TAG_BOT,condition:function(t,e,r){return r.bot},verified:function(t,e,r){return r.isVerifiedBot()}},{text:"ADMIN",backgroundColor:c.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:c.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:c.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function B(t,e,r){let a;if(t){const n=N({user:r,context:t,overwrites:e?.permissionOverwrites});a=Object.entries(T).map(function(o){let[i,l]=o;return n&l?i:""}).filter(Boolean)}for(const n of G)if(n.condition?.(t,e,r)||n.permissions?.some(function(o){return a?.includes(o)})){let o=C.storage.useRoleColor?_.getMember(t?.id,r.id)?.colorString:void 0,i=o||(n.backgroundColor??c.rawColors.BRAND_500),l=o||!n.textColor?u.chroma(i).get("lab.l")<70?c.rawColors.WHITE_500:c.rawColors.BLACK_500:n.textColor;return{...n,textColor:l,backgroundColor:i,verified:typeof n.verified=="function"?n.verified(t,e,r):n.verified??!1,condition:void 0,permissions:void 0}}}const A=s.findByName("getTagProperties",!1),M=s.findByStoreName("GuildStore"),I=s.findByStoreName("ChannelStore");function w(){return f.after("default",A,function(t,e){let[{message:r}]=t;if(!E.includes(e.tagText)){const a=I.getChannel(r.channel_id),n=M.getGuild(a?.guild_id),o=B(n,a,r.author);if(o)return{...e,tagText:o.text,tagTextColor:o.textColor?u.ReactNative.processColor(u.chroma(o.textColor).hex()):void 0,tagBackgroundColor:o.backgroundColor?u.ReactNative.processColor(u.chroma(o.backgroundColor).hex()):void 0,tagVerified:o.verified,tagType:void 0}}})}const x=s.findByProps("getBotLabel"),k=x.getBotLabel,m=s.findByStoreName("GuildStore"),O=function(t,e){let[{guildId:r,user:a}]=t;if(!e)return;const n=d.findInReactTree(e.props.label,function(o){return o?.type?.Types});if(!n||!E.includes(k(n.props.type))){const o=m.getGuild(r),i=B(o,void 0,a);if(i)if(n)n.props={type:0,...i};else{const l=d.findInReactTree(e.props.label,function(y){return y.props?.lineClamp}).props.children;l.props.children[1]=React.createElement(React.Fragment,null," ",React.createElement(x.default,{type:0,text:i.text,textColor:i.textColor,backgroundColor:i.backgroundColor,verified:i.verified}))}}};function L(){const t=[];return s.findByTypeNameAll("UserRow").forEach(function(e){return t.push(f.after("type",e,O))}),function(){return t.forEach(function(e){return e()})}}const D=s.findByName("DisplayName",!1),P=s.findByName("HeaderName",!1),h=s.findByProps("getBotLabel"),U=h.getBotLabel,$=s.findByStoreName("GuildStore"),H=s.findByStoreName("ChannelStore");function K(){const t=[];return t.push(f.after("default",P,function(e,r){let[{channelId:a}]=e;r.props.channelId=a})),t.push(f.after("default",D,function(e,r){let[{guildId:a,channelId:n,user:o}]=e;if(!r)return;const i=d.findInReactTree(r,function(l){return l?.type?.Types});if(!i||!E.includes(U(i.props.type))){const l=$.getGuild(a),y=H.getChannel(n),g=B(l,y,o);g&&(i?i.props={type:0,...g}:d.findInReactTree(r,function(ee){return ee.props.style.flexDirection==="row"}).props.children.push(React.createElement(h.default,{style:{marginLeft:0},type:0,text:g.text,textColor:g.textColor,backgroundColor:g.backgroundColor,verified:g.verified})))}})),function(){return t.forEach(function(e){return e()})}}const V=s.findByProps("GuildMemberRow"),v=s.findByProps("getBotLabel"),F=v.getBotLabel,W=s.findByStoreName("GuildStore");function j(){return f.after("type",V.GuildMemberRow,function(t,e){let[{guildId:r,channel:a,user:n}]=t;if(!e)return;const o=d.findInReactTree(e,function(i){return i?.type?.Types});if(!o||!E.includes(F(o.props.type))){const i=W.getGuild(r),l=B(i,a,n);l&&(o?o.props={type:0,...l}:d.findInReactTree(e,function(y){return y.props.style.flexDirection==="row"}).props.children.splice(2,0,React.createElement(v.default,{type:0,text:l.text,textColor:l.textColor,backgroundColor:l.backgroundColor,verified:l.verified})))}})}const X=s.findByProps("getBotLabel");function Y(){return f.after("default",X,function(t,e){let[{text:r,textColor:a,backgroundColor:n}]=t;if(!e)return;const o=d.findInReactTree(e,function(i){return typeof i?.props?.children=="string"});r&&(o.props.children=r),a&&o.props.style.push({color:a}),n&&e.props.style.push({backgroundColor:n})})}const{ScrollView:q}=b.General,{FormSection:z,FormSwitchRow:J}=b.Forms;function Q(){return S.useProxy(C.storage),React.createElement(q,{style:{flex:1}},React.createElement(z,{title:"Tag style"},React.createElement(J,{label:"Use top role color for tag backgrounds",value:C.storage.useRoleColor,onValueChange:function(t){C.storage.useRoleColor=t}})))}let p=[];var Z={onLoad:function(){C.storage.useRoleColor??=!1,p.push(w()),p.push(Y()),p.push(K()),p.push(j()),p.push(L())},onUnload:function(){return p.forEach(function(t){return t()})},settings:Q};return R.default=Z,Object.defineProperty(R,"__esModule",{value:!0}),R})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
