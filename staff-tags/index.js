(function(y,f,s,u,p,d,g,x,S){"use strict";const{Permissions:N}=u.constants,{computePermissions:M}=s.findByProps("computePermissions","canEveryoneRole"),T=s.findByStoreName("GuildMemberStore"),E=[u.i18n.Messages.AI_TAG,u.i18n.Messages.BOT_TAG_SERVER,u.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,u.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,u.i18n.Messages.REMIXING_TAG],b=[{text:"WEBHOOK",condition:function(t,o,e){return e.isNonUserBot()}},{text:"OWNER",backgroundColor:d.rawColors.ORANGE_345,condition:function(t,o,e){return t?.ownerId===e.id}},{text:u.i18n.Messages.BOT_TAG_BOT,condition:function(t,o,e){return e.bot},verified:function(t,o,e){return e.isVerifiedBot()}},{text:"ADMIN",backgroundColor:d.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:d.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:d.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function B(t,o,e){let a;if(t){const n=M({user:e,context:t,overwrites:o?.permissionOverwrites});a=Object.entries(N).map(function(r){let[i,l]=r;return n&l?i:""}).filter(Boolean)}for(const n of b)if(n.condition?.(t,o,e)||n.permissions?.some(function(r){return a?.includes(r)})){let r=f.storage.useRoleColor?T.getMember(t?.id,e.id)?.colorString:void 0,i=r||(n.backgroundColor??d.rawColors.BRAND_500),l=r||!n.textColor?u.chroma(i).get("lab.l")<70?d.rawColors.WHITE_500:d.rawColors.BLACK_500:n.textColor;return{...n,textColor:l,backgroundColor:i,verified:typeof n.verified=="function"?n.verified(t,o,e):n.verified??!1,condition:void 0,permissions:void 0}}}const A=s.findByName("getTagProperties",!1),G=s.findByStoreName("GuildStore"),h=s.findByStoreName("ChannelStore");function I(){return p.after("default",A,function(t,o){let[{message:e}]=t;if(!E.includes(o.tagText)){const a=h.getChannel(e.channel_id),n=G.getGuild(a?.guild_id),r=B(n,a,e.author);if(r)return{...o,tagText:r.text,tagTextColor:r.textColor?u.ReactNative.processColor(u.chroma(r.textColor).hex()):void 0,tagBackgroundColor:r.backgroundColor?u.ReactNative.processColor(u.chroma(r.backgroundColor).hex()):void 0,tagVerified:r.verified,tagType:void 0}}})}const w=s.findByName("DisplayName",!1),O=s.findByName("HeaderName",!1),_=s.findByProps("getBotLabel"),k=_.getBotLabel,m=s.findByStoreName("GuildStore"),L=s.findByStoreName("ChannelStore");function D(){const t=[];return t.push(p.after("default",O,function(o,e){let[{channelId:a}]=o;e.props.channelId=a})),t.push(p.after("default",w,function(o,e){let[{guildId:a,channelId:n,user:r}]=o;if(!e)return;const i=g.findInReactTree(e,function(l){return l?.type?.Types});if(!i||!E.includes(k(i.props.type))){const l=m.getGuild(a),R=L.getChannel(n),c=B(l,R,r);c&&(i?i.props={type:0,...c}:g.findInReactTree(e,function(q){return q.props.style.flexDirection==="row"}).props.children.push(React.createElement(_.default,{style:{marginLeft:0},type:0,text:c.text,textColor:c.textColor,backgroundColor:c.backgroundColor,verified:c.verified})))}})),function(){return t.forEach(function(o){return o()})}}const P=s.findByProps("GuildMemberRow"),v=s.findByProps("getBotLabel"),U=v.getBotLabel,$=s.findByStoreName("GuildStore");function H(){return p.after("type",P.GuildMemberRow,function(t,o){let[{guildId:e,channel:a,user:n}]=t;if(!o)return;const r=g.findInReactTree(o,function(i){return i?.type?.Types});if(!r||!E.includes(U(r.props.type))){const i=$.getGuild(e),l=B(i,a,n);l&&(r?r.props={type:0,...l}:g.findInReactTree(o,function(R){return R.props.style.flexDirection==="row"}).props.children.splice(2,0,React.createElement(v.default,{type:0,text:l.text,textColor:l.textColor,backgroundColor:l.backgroundColor,verified:l.verified})))}})}const K=s.findByProps("getBotLabel");function V(){return p.after("default",K,function(t,o){let[{text:e,textColor:a,backgroundColor:n}]=t;if(!o)return;const r=g.findInReactTree(o,function(i){return typeof i?.props?.children=="string"});e&&(r.props.children=e),a&&r.props.style.push({color:a}),n&&o.props.style.push({backgroundColor:n})})}const{ScrollView:W}=S.General,{FormSection:F,FormSwitchRow:j}=S.Forms;function X(){return x.useProxy(f.storage),React.createElement(W,{style:{flex:1}},React.createElement(F,{title:"Tag style"},React.createElement(j,{label:"Use top role color for tag backgrounds",value:f.storage.useRoleColor,onValueChange:function(t){f.storage.useRoleColor=t}})))}let C=[];var Y={onLoad:function(){f.storage.useRoleColor??=!1,C.push(I()),C.push(V()),C.push(D()),C.push(H())},onUnload:function(){return C.forEach(function(t){return t()})},settings:X};return y.default=Y,Object.defineProperty(y,"__esModule",{value:!0}),y})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
