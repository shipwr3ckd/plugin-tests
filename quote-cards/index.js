(function(i,n,a,c,d,u,m){"use strict";const l=n.findByProps("openLazy","hideActionSheet"),r=n.findByProps("ActionSheetRow")?.ActionSheetRow;n.findByStoreName("MessageStore");const h=n.findByStoreName("UserStore"),{uploadLocalFiles:y}=n.findByProps("uploadLocalFiles"),{getToken:v}=n.findByProps("getToken");let g;function S(){g=c.after("openLazy",l,function(B){let[T,A,L]=B;A==="MessageLongPressActionSheet"&&T.then(function(M){c.after("default",M,function(Q,P){const t=L?.message;if(!t)return;const o=m.findInReactTree(P,function(e){return Array.isArray(e)&&e.some(function(s){return s?.type===r})});if(!o||o.find(function(e){return e?.props?.label==="Quote Message"}))return;const b=Math.max(o.findIndex(function(e){return e?.props?.label==="Copy Text"}),1),E=async function(){try{const e=t.author??h.getUser(t.author?.id),s=new Date(t.timestamp).toISOString(),N={text:t.content,username:e?.username??"Unknown",timestamp:s,avatarUrl:`https://cdn.discordapp.com/avatars/${e?.id}/${e?.avatar}.png?size=256`},f=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)});if(!f.ok)throw new Error("Failed to generate image");const R=await f.arrayBuffer(),q=new Blob([R],{type:"image/png"}),p=new File([q],"quote.png",{type:"image/png"});u.showToast("\u2705 Quote generated, sending..."),y?.([{channelId:t.channel_id,parsedMessage:{content:"",tts:!1,invalidEmojis:[],validNonShortcutEmojis:[]},items:[{item:{uri:p,filename:"quote.png",mimeType:"image/png",width:500,height:200,id:"quote",platform:0,origin:1},isImage:!0,isVideo:!1,mimeType:"image/png",filename:"quote.png",id:"quote",uri:p,channelId:t.channel_id}],token:v()}])}catch(e){u.showToast("\u274C Quote generation failed"),console.error("Quote generation error:",e)}finally{l.hideActionSheet()}};o.splice(b,0,a.React.createElement(r,{label:"Quote Message",icon:a.React.createElement(r.Icon,{source:d.getAssetIDByName("ic_message"),IconComponent:function(){return a.React.createElement(a.ReactNative.Image,{style:{width:24,height:24},source:d.getAssetIDByName("ic_message")})}}),onPress:E}))})})})}function w(){g?.()}var I={onLoad:S,onUnload:w};return i.default=I,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils);
