(function(n,l,t){"use strict";const u=t.findByStoreName("MessageStore");t.findByStoreName("UserStore");const{uploadLocalFiles:m}=t.findByProps("uploadLocalFiles"),p=t.findByProps("getToken").getToken();let i;var g={onLoad:function(){i=l.registerCommand({name:"quote",displayName:"quote",displayDescription:"Generate quote image from a message link",description:"Generate quote image from a message link",options:[{name:"link",description:"Discord message link",type:3,required:!0,displayName:"link",displayDescription:"Discord message link"}],execute:f,applicationId:"-1",inputType:1,type:1})},onUnload:function(){i()}};async function f(y,h){const o=y[0].value.trim().match(/\/channels\/(\d+)\/(\d+)\/(\d+)/);if(!o)return{content:"\u274C Invalid message link format."};const[,,k,q]=o,r=u.getMessage(k,q);if(!r)return{content:"\u274C Couldn't fetch that message. Please open it at least once in the app first."};const{content:s,author:a,timestamp:v}=r,d=a?.getAvatarURL?.(4096);if(!s||!a||!d)return{content:"\u274C Failed to parse message details."};try{const e=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:s,username:a.username,timestamp:v,avatarUrl:d})});if(!e.ok){const w=await e.text();return console.error("Quote card error:",w),{content:"\u274C Failed to generate quote card."}}const C=await(await e.blob()).arrayBuffer(),c=new Uint8Array(C),b={item:{id:"quote.png",filename:"quote.png",uri:`data:image/png;base64,${btoa(String.fromCharCode(...c))}`,mimeType:"image/png",width:800,height:400,size:c.byteLength,platform:0,playableDuration:0,originalUri:""},id:"quote.png",filename:"quote.png",isImage:!0,isVideo:!1,mimeType:"image/png",origin:1};await m([{channelId:h.channel.id,items:[b],parsedMessage:{content:"",tts:!1,invalidEmojis:[],validNonShortcutEmojis:[]},token:p}])}catch(e){return console.error("Quote upload error:",e),{content:"\u274C An error occurred while sending the quote."}}}return n.default=g,Object.defineProperty(n,"__esModule",{value:!0}),n})({},vendetta.commands,vendetta.metro);
