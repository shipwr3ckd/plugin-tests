(function(i,n,a,u,d,r,m){"use strict";const l=n.findByProps("openLazy","hideActionSheet"),s=n.findByProps("ActionSheetRow")?.ActionSheetRow;n.findByStoreName("MessageStore");const h=n.findByStoreName("UserStore"),{uploadLocalFiles:y}=n.findByProps("uploadLocalFiles")??{},{getToken:S}=n.findByProps("getToken");let g;function v(){return u.after("openLazy",l,function(T){let[A,B,U]=T;B==="MessageLongPressActionSheet"&&A.then(function(b){g=u.after("default",b,function(N,E){const t=U?.message;if(!t)return;const o=m.findInReactTree(E,function(e){return Array.isArray(e)&&e.some(function(c){return c?.type===s})});if(!o||o.some(function(e){return e?.props?.label==="Quote Message"}))return;const P=Math.max(o.findIndex(function(e){return e?.props?.label==="Copy Text"}),1),R=async function(){try{const e=t.author??h.getUser(t.author?.id),c=new Date(t.timestamp).toISOString(),q={text:t.content,username:e?.username??"Unknown",timestamp:c,avatarUrl:`https://cdn.discordapp.com/avatars/${e?.id}/${e?.avatar}.png?size=256`};r.showToast("\u2699\uFE0F Generating quote...");const f=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)});if(!f.ok)throw new Error("Failed to generate image");const C=await f.arrayBuffer(),L=Array.from(new Uint8Array(C)).map(function(M){return String.fromCharCode(M)}).join(""),p=`data:image/png;base64,${btoa(L)}`;r.showToast("\u2705 Quote generated, sending..."),console.log("\u2705 Uploading quote.png..."),y?.({channelId:t.channel_id,parsedMessage:{content:"",tts:!1,invalidEmojis:[],validNonShortcutEmojis:[]},items:[{item:{uri:p,filename:"quote.png",mimeType:"image/png",width:500,height:200,id:"quote",platform:0,origin:1},isImage:!0,isVideo:!1,mimeType:"image/png",filename:"quote.png",id:"quote",uri:p,channelId:t.channel_id}],token:S()})}catch(e){console.error("\u274C Quote generation error:",e),r.showToast("\u274C Quote generation failed")}finally{l.hideActionSheet()}};o.splice(P,0,a.React.createElement(s,{label:"Quote Message",icon:a.React.createElement(s.Icon,{source:d.getAssetIDByName("ic_message"),IconComponent:function(){return a.React.createElement(a.ReactNative.Image,{style:{width:24,height:24},source:d.getAssetIDByName("ic_message")})}}),onPress:R}))})})})}function w(){g?.()}var I={onLoad:v,onUnload:w};return i.default=I,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils);
