(function(c,a,i,h,n,w){"use strict";const m=a.findByProps("openLazy","hideActionSheet"),u=a.findByProps("ActionSheetRow")?.ActionSheetRow,S=a.findByStoreName("MessageStore"),v=a.findByStoreName("UserStore"),_=function(){};function C(){m.openLazy("MessageLongPressActionSheet",async function(){const s=await import("@vendetta/ui/components/MessageLongPressActionSheet");if(!s?.default)return s;const I=s.default;return s.default=function(d){const l=I(d);try{const o=w.findInReactTree(l,function(e){return Array.isArray(e)&&e.some(function(r){return r?.type===u})});if(!o||o.some(function(e){return e?.props?.label==="Quote Message"}))return l;const P=Math.max(o.findIndex(function(e){return e?.props?.label==="Copy Text"}),1);o.splice(P,0,i.React.createElement(u,{label:"Quote Message",icon:i.React.createElement(u.Icon,{source:h.getAssetIDByName("ic_message"),IconComponent:function(){return i.React.createElement(i.ReactNative.Image,{style:{width:24,height:24},source:h.getAssetIDByName("ic_message")})}}),onPress:async function(){try{const e=d?.message?.id,r=d?.message?.channel_id;if(!e||!r){n.showToast("\u274C Failed to locate message");return}const t=S.getMessage(r,e);if(!t){n.showToast("\u274C Could not fetch message content");return}const f=t.author??v.getUser(t.author?.id),T=new Date(t.timestamp).toISOString(),M={text:t.content.replace(/[\p{Emoji_Presentation}\p{Extended_Pictographic}]/gu,""),username:f?.username??"Unknown",timestamp:T,avatarUrl:`https://cdn.discordapp.com/avatars/${f?.id}/${f?.avatar}.png?size=4096`},g=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(M)});if(!g.ok){n.showToast("\u274C Failed to generate quote"),console.error("\u274C Quote API error:",g.status);return}const y=await g.json(),p=y?.url;if(!p||typeof p!="string"){n.showToast("\u274C Invalid image URL returned"),console.error("\u274C Bad response:",y);return}const{sendMessage:R}=a.findByProps("sendMessage");R(r,{content:p,message_reference:{message_id:t.id,channel_id:r,guild_id:t.guild_id??void 0}}),n.showToast("\u2705 Quote sent!")}catch(e){n.showToast("\u274C Error sending quote"),console.error("\u274C Exception:",e)}finally{m.hideActionSheet()}}}))}catch(o){console.error("Quote patch error:",o)}return l},s})}var A={onLoad:C,onUnload:_};return c.default=A,Object.defineProperty(c,"__esModule",{value:!0}),c})({},vendetta.metro,vendetta.metro.common,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils);
