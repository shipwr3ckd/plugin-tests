(function(s,t,o,d,f,y){"use strict";const l=t.findByProps("openLazy","hideActionSheet"),i=t.findByProps("ActionSheetRow")?.ActionSheetRow,m=t.findByStoreName("MessageStore"),S=t.findByStoreName("UserStore");let p;const v=function(){p?.()};function A(){p=d.after("openLazy",l,function(P){let[w,I,j]=P;I==="MessageLongPressActionSheet"&&w.then(function(_){d.after("default",_,function(B,R){let[g]=B;const r=y.findInReactTree(R,function(e){return Array.isArray(e)&&e.some(function(n){return n?.type===i})});if(!r||r.some(function(e){return e?.props?.label==="Quote Message"}))return;const U=Math.max(r.findIndex(function(e){return e?.props?.label==="Copy Text"}),1);r.splice(U,0,o.React.createElement(i,{label:"Quote Message",icon:o.React.createElement(i.Icon,{source:f.getAssetIDByName("ic_message"),IconComponent:function(){return o.React.createElement(o.ReactNative.Image,{style:{width:24,height:24},source:f.getAssetIDByName("ic_message")})}}),onPress:async function(){try{const e=g?.message?.id,n=g?.message?.channel_id;if(!e||!n)return;const a=m.getMessage(n,e);if(!a)return;const c=a.author??S.getUser(a.author?.id),b=new Date(a.timestamp).toISOString(),E={text:a.content.replace(/[\p{Emoji_Presentation}\p{Extended_Pictographic}]/gu,""),username:c?.username??"Unknown",timestamp:b,avatarUrl:`https://cdn.discordapp.com/avatars/${c?.id}/${c?.avatar}.png?size=4096`},h=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)});if(!h.ok)return;const u=(await h.json())?.url;if(!u||typeof u!="string")return;const{sendMessage:N}=t.findByProps("sendMessage");N(n,{content:u})}catch(e){console.error("Quote error",e)}finally{l.hideActionSheet()}}}))})})})}var M={onLoad:A,onUnload:v};return s.default=M,Object.defineProperty(s,"__esModule",{value:!0}),s})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.utils);
