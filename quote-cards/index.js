(function(r,n,a,l,g,i,y){"use strict";const p=n.findByProps("openLazy","hideActionSheet"),s=n.findByProps("ActionSheetRow")?.ActionSheetRow;n.findByStoreName("MessageStore");const v=n.findByStoreName("UserStore"),{uploadLocalFiles:S}=n.findByProps("uploadLocalFiles"),w=n.findByProps("getToken")?.getToken?.();let c;const T=function(){c?.()};function R(){c=l.after("openLazy",p,function(L){let[U,I,b]=L;I==="MessageLongPressActionSheet"&&U.then(function(q){c=l.after("default",q,function(j,B){const t=b?.message;if(!t)return;const u=y.findInReactTree(B,function(e){return Array.isArray(e)&&e.some(function(d){return d?.type===s})});if(!u||u.find(function(e){return e?.props?.label==="Quote Message"}))return;const o=t.author||v.getUser(t.author?.id),f=new Date(t.timestamp).toISOString(),m=o?.avatar?`https://cdn.discordapp.com/avatars/${o.id}/${o.avatar}.png?size=256`:`https://cdn.discordapp.com/embed/avatars/${(parseInt(o.id)>>22)%5}.png`,E=async function(){try{i.showToast("\u{1F5BC}\uFE0F Generating quote..."),console.log("\u{1F4E4} Sending to quote generator",{text:t.content,username:o?.username,timestamp:f,avatarUrl:m});const e=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t.content,username:o?.username??"Unknown",timestamp:f,avatarUrl:m})});if(!e.ok){i.showToast("\u274C Quote generation failed"),console.error("Quote generation failed: HTTP",e.status);return}const d=await e.blob(),h=new File([d],"quote.png",{type:"image/png"}),P={content:"",tts:!1,invalidEmojis:[],validNonShortcutEmojis:[]},Q=[{item:{id:"quote",uri:URL.createObjectURL(h),originalUri:URL.createObjectURL(h),mimeType:"image/png",filename:"quote.png",width:500,height:500,platform:0},id:"quote",filename:"quote.png",isImage:!0,mimeType:"image/png",channelId:t.channel_id}];await S?.([{ctx:{channel:t.channel_id},items:Q,token:w,parsedMessage:P}]),i.showToast("\u2705 Quote sent!"),console.log("\u2705 Quote uploaded")}catch(e){i.showToast("\u274C Error sending quote"),console.error("Quote generation error:",e)}finally{p.hideActionSheet()}};u.splice(1,0,a.React.createElement(s,{label:"Quote Message",icon:a.React.createElement(s.Icon,{source:g.getAssetIDByName("ic_message"),IconComponent:function(){return a.React.createElement(a.ReactNative.Image,{style:{width:24,height:24},source:g.getAssetIDByName("ic_message")})}}),onPress:E}))})})})}var A={onLoad:function(){R()},onUnload:function(){T?.()}};return r.default=A,Object.defineProperty(r,"__esModule",{value:!0}),r})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils);
