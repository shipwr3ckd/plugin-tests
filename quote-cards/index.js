(function(i,t,o,f,g,c,m){"use strict";const p=t.findByProps("openLazy","hideActionSheet"),u=t.findByProps("ActionSheetRow")?.ActionSheetRow;t.findByStoreName("MessageStore");const y=t.findByStoreName("UserStore"),{uploadLocalFiles:w}=t.findByProps("uploadLocalFiles"),S=t.findByProps("getToken")?.getToken();let d;function v(){return f.after("openLazy",p,function(T){let[P,R,b]=T;R==="MessageLongPressActionSheet"&&P.then(function(Q){d=f.after("default",Q,function(F,B){const n=b?.message;if(!n)return;const a=m.findInReactTree(B,function(e){return Array.isArray(e)&&e.some(function(l){return l?.type===u})});if(!a||a.some(function(e){return e?.props?.label==="Quote Message"}))return;const C=Math.max(a.findIndex(function(e){return e?.props?.label==="Copy Text"}),1),U=async function(){try{const e=n.author||y.getUser(n.author?.id),l=new Date(n.timestamp).toISOString(),E={text:n.content,username:e?.username??"Unknown",timestamp:l,avatarUrl:`https://cdn.discordapp.com/avatars/${e?.id}/${e?.avatar}.png?size=256`},h=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)});if(!h.ok)throw new Error("Quote card API request failed");const L=await h.blob(),r=new FileReader;r.onloadend=async function(){const s=r.result?.split(",")[1];if(!s)throw new Error("Failed to get base64");const M=[{item:{uri:`data:image/png;base64,${s}`,filename:"quote.png",mimeType:"image/png",isImage:!0}}],k={content:""};await w([{channelId:n.channel_id,items:M,token:S,parsedMessage:k}]),c.showToast("\u2705 Quote sent!"),console.log("[QuoteCard] Quote sent successfully.")},r.onerror=function(s){console.error("\u274C Failed to read image:",s),c.showToast("\u274C Error reading image")},r.readAsDataURL(L)}catch(e){console.error("\u274C Quote generation failed:",e),c.showToast("\u274C Quote generation failed")}finally{p.hideActionSheet()}};a.splice(C,0,o.React.createElement(u,{label:"Quote Message",icon:o.React.createElement(u.Icon,{source:g.getAssetIDByName("ic_message"),IconComponent:function(){return o.React.createElement(o.ReactNative.Image,{style:{width:24,height:24},source:g.getAssetIDByName("ic_message")})}}),onPress:U}))})})})}function I(){d&&d()}var A={onLoad:v,onUnload:I};return i.default=A,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils);
