(function(r,n,a,d,u,h){"use strict";const f=n.findByProps("openLazy","hideActionSheet"),i=n.findByProps("ActionSheetRow")?.ActionSheetRow,g=n.findByStoreName("MessageStore"),y=n.findByStoreName("UserStore");let l;const m=function(){l?.()};function S(){l=d.after("openLazy",f,function(v){let[M,P]=v;P==="MessageLongPressActionSheet"&&M.then(function(A){d.after("default",A,function(w,I){let[R]=w;const o=h.findInReactTree(I,function(e){return Array.isArray(e)&&e.some(function(t){return t?.type===i})});if(!o||o.some(function(e){return e?.props?.label==="Quote Message"}))return;const x=Math.max(o.findIndex(function(e){return e?.props?.label==="Copy Text"}),1);o.splice(x,0,a.React.createElement(i,{label:"Quote Message",icon:a.React.createElement(i.Icon,{source:u.getAssetIDByName(ic_chat_24px),IconComponent:function(){return a.React.createElement(a.ReactNative.Image,{style:{width:24,height:24},source:u.getAssetIDByName(ic_chat_24px)})}}),onPress:async function(){try{const{message:e}=R;if(!e?.id||!e?.channel_id)return;const t=g.getMessage(e.channel_id,e.id);if(!t)return;const s=t.author??y.getUser(t.author?.id),B={text:t.content.replace(/[\p{Emoji_Presentation}\p{Extended_Pictographic}]/gu,""),username:s?.username??"Unknown",timestamp:new Date(t.timestamp).toISOString(),avatarUrl:`https://cdn.discordapp.com/avatars/${s?.id}/${s?.avatar}.png?size=4096`},p=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)});if(!p.ok)return;const c=(await p.json())?.url;if(!c||typeof c!="string")return;const{sendMessage:b}=n.findByProps("sendMessage");b(e.channel_id,{content:c})}catch(e){console.error("Quote error",e)}finally{f.hideActionSheet()}}}))})})})}var _={onLoad:S,onUnload:m};return r.default=_,Object.defineProperty(r,"__esModule",{value:!0}),r})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.utils);
