(function(i,n,o,l,f,a,y){"use strict";const g=n.findByProps("openLazy","hideActionSheet"),u=n.findByProps("ActionSheetRow")?.ActionSheetRow;n.findByStoreName("MessageStore");const m=n.findByStoreName("UserStore");let h;const v=function(){h?.()};function S(){h=l.after("openLazy",g,function(w){let[_,I,R]=w;I==="MessageLongPressActionSheet"&&_.then(function(C){l.after("default",C,function(M,F){const t=R?.message;if(!t)return;const s=y.findInReactTree(F,function(e){return Array.isArray(e)&&e.some(function(c){return c?.type===u})});if(!s||s.some(function(e){return e?.props?.label==="Quote Message"}))return;const P=Math.max(s.findIndex(function(e){return e?.props?.label==="Copy Text"}),1),U=async function(){try{const e=t.author??m.getUser(t.author?.id),c=new Date(t.timestamp).toISOString(),B={text:t.content.replace(/[\u{1F3FB}-\u{1FAFF}\u200D\uFE0F]/gu,""),username:e?.username??"Unknown",timestamp:c,avatarUrl:`https://cdn.discordapp.com/avatars/${e?.id}/${e?.avatar}.png?size=4096`},d=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)});if(!d.ok){a.showToast("\u274C Failed to generate quote"),console.error("\u274C Quote API returned:",d.status);return}const p=await d.json(),r=p?.url;if(!r||typeof r!="string"){a.showToast("\u274C Invalid image URL returned"),console.error("\u274C Quote API response missing or invalid URL:",p);return}const{sendMessage:L}=n.findByProps("sendMessage");L(t.channel_id,{content:r,message_reference:{message_id:t.id,channel_id:t.channel_id,guild_id:t.guild_id??void 0}}),a.showToast("\u2705 Quote sent!"),console.log("\u2705 Quote URL:",r)}catch(e){a.showToast("\u274C Error sending quote"),console.error("\u274C Quote generation failed:",e)}finally{g.hideActionSheet()}};s.splice(P,0,o.React.createElement(u,{label:"Quote Message",icon:o.React.createElement(u.Icon,{source:f.getAssetIDByName("ic_message"),IconComponent:function(){return o.React.createElement(o.ReactNative.Image,{style:{width:24,height:24},source:f.getAssetIDByName("ic_message")})}}),onPress:U}))})})})}var A={onLoad:S,onUnload:v};return i.default=A,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils);
