(function(r,t,u,d,h,m){"use strict";const f=t.findByProps("openLazy","hideActionSheet"),s=t.findByProps("ActionSheetRow")?.ActionSheetRow,S=t.findByStoreName("MessageStore"),v=t.findByStoreName("UserStore");let p;const M=function(){p?.()};function P(){p=d.after("openLazy",f,function(_){let[b,w]=_;w==="MessageLongPressActionSheet"&&b.then(function(R){d.after("default",R,function(x,B){let[l]=x;const n=m.findInReactTree(B,function(e){return Array.isArray(e)&&e.some(function(o){return o?.type===s})});if(!n||n.some(function(e){return e?.props?.label==="Quote Message"}))return;const y=n.findIndex(function(e){return e?.props?.label==="Reply"}),I=y>-1?y:Math.max(n.findIndex(function(e){return e?.props?.label==="Copy Text"}),0);n.splice(I,0,u.React.createElement(s,{label:"Quote Message",icon:u.React.createElement(s.Icon,{source:h.getAssetIDByName("ic_chat_24px")}),onPress:async function(){try{const e=l?.message?.id,o=l?.message?.channel_id;if(!e||!o)return;const a=S.getMessage(o,e);if(!a)return;const i=a.author??v.getUser(a.author?.id),U={text:a.content.replace(/[\p{Emoji_Presentation}\p{Extended_Pictographic}]/gu,""),username:i?.username??"Unknown",timestamp:new Date(a.timestamp).toISOString(),avatarUrl:`https://cdn.discordapp.com/avatars/${i?.id}/${i?.avatar}.png?size=4096`},g=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(U)});if(!g.ok)return;const c=(await g.json())?.url;if(!c||typeof c!="string")return;const{sendMessage:j}=t.findByProps("sendMessage");j(o,{content:c})}catch(e){console.error("Quote error",e)}finally{f.hideActionSheet()}}}))})})})}var A={onLoad:P,onUnload:M};return r.default=A,Object.defineProperty(r,"__esModule",{value:!0}),r})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.utils);
