(function(i,a,s,l,f,n,y){"use strict";const g=a.findByProps("openLazy","hideActionSheet"),c=a.findByProps("ActionSheetRow")?.ActionSheetRow,v=a.findByStoreName("MessageStore"),w=a.findByStoreName("UserStore");let h;const S=function(){h?.()};function _(){h=l.after("openLazy",g,function(P){let[I,M,N]=P;M==="MessageLongPressActionSheet"&&I.then(function(T){l.after("default",T,function(C,R){let[p]=C;const r=y.findInReactTree(R,function(e){return Array.isArray(e)&&e.some(function(o){return o?.type===c})});if(!r||r.some(function(e){return e?.props?.label==="Quote Message"}))return;const U=Math.max(r.findIndex(function(e){return e?.props?.label==="Copy Text"}),1);r.splice(U,0,s.React.createElement(c,{label:"Quote Message",icon:s.React.createElement(c.Icon,{source:f.getAssetIDByName("ic_message"),IconComponent:function(){return s.React.createElement(s.ReactNative.Image,{style:{width:24,height:24},source:f.getAssetIDByName("ic_message")})}}),onPress:async function(){try{const e=p?.message?.id,o=p?.message?.channel_id;if(!e||!o){n.showToast("\u274C Could not identify message.");return}const t=v.getMessage(o,e);if(!t){n.showToast("\u274C Message not found.");return}const u=t.author??w.getUser(t.author?.id),B=new Date(t.timestamp).toISOString(),E={text:t.content.replace(/[\p{Emoji_Presentation}\p{Extended_Pictographic}]/gu,""),username:u?.username??"Unknown",timestamp:B,avatarUrl:`https://cdn.discordapp.com/avatars/${u?.id}/${u?.avatar}.png?size=4096`},m=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)});if(!m.ok){n.showToast("\u274C Quote API error");return}const d=(await m.json())?.url;if(!d||typeof d!="string"){n.showToast("\u274C Invalid quote image URL");return}a.findByProps("sendMessage").sendMessage(o,{content:d,tts:!1,message_reference:{message_id:t.id,channel_id:o,guild_id:t.guild_id??void 0},allowed_mentions:{parse:[],replied_user:!1}}),n.showToast("\u2705 Quote sent!")}catch(e){console.error("Quote error",e),n.showToast("\u274C Failed to send quote")}finally{g.hideActionSheet()}}}))})})})}var A={onLoad:_,onUnload:S};return i.default=A,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils);
