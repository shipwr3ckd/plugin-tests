(function(i,a,s,f,g,n,v){"use strict";const h=a.findByProps("openLazy","hideActionSheet"),c=a.findByProps("ActionSheetRow")?.ActionSheetRow,w=a.findByStoreName("MessageStore"),S=a.findByStoreName("UserStore");let p;const C=function(){p?.()};function _(){p=f.after("openLazy",h,function(I){let[T,M,m]=I;M==="MessageLongPressActionSheet"&&T.then(function(P){f.after("default",P,function(x,B){const r=v.findInReactTree(B,function(e){return Array.isArray(e)&&e.some(function(o){return o?.type===c})});if(!r||r.some(function(e){return e?.props?.label==="Quote Message"}))return;const E=Math.max(r.findIndex(function(e){return e?.props?.label==="Copy Text"}),1);r.splice(E,0,s.React.createElement(c,{label:"Quote Message",icon:s.React.createElement(c.Icon,{source:g.getAssetIDByName("ic_message"),IconComponent:function(){return s.React.createElement(s.ReactNative.Image,{style:{width:24,height:24},source:g.getAssetIDByName("ic_message")})}}),onPress:async function(){try{const e=m?.message?.id,o=m?.message?.channel_id;if(!e||!o){n.showToast("\u274C Failed to locate message");return}const t=w.getMessage(o,e);if(!t){n.showToast("\u274C Could not fetch message content");return}const u=t.author??S.getUser(t.author?.id),R=new Date(t.timestamp).toISOString(),U={text:t.content.replace(/[\p{Emoji_Presentation}\p{Extended_Pictographic}]/gu,""),username:u?.username??"Unknown",timestamp:R,avatarUrl:`https://cdn.discordapp.com/avatars/${u?.id}/${u?.avatar}.png?size=4096`},d=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(U)});if(!d.ok){n.showToast("\u274C Failed to generate quote"),console.error("\u274C Quote API error:",d.status);return}const y=await d.json(),l=y?.url;if(!l||typeof l!="string"){n.showToast("\u274C Invalid image URL returned"),console.error("\u274C Bad response:",y);return}const{sendMessage:b}=a.findByProps("sendMessage");b(o,{content:l,message_reference:{message_id:t.id,channel_id:o,guild_id:t.guild_id??void 0}}),n.showToast("\u2705 Quote sent!")}catch(e){n.showToast("\u274C Error sending quote"),console.error("\u274C Exception:",e)}finally{h.hideActionSheet()}}}))})})})}var A={onLoad:_,onUnload:C};return i.default=A,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils);
