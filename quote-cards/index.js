(function(s,n,o,f,p,i,m){"use strict";const h=n.findByProps("openLazy","hideActionSheet"),c=n.findByProps("ActionSheetRow")?.ActionSheetRow,y=n.findByStoreName("UserStore"),{uploadLocalFiles:w}=n.findByProps("uploadLocalFiles"),C=n.findByProps("getToken")?.getToken();let u;function v(){return f.after("openLazy",h,function(I){let[S,P,b]=I;P==="MessageLongPressActionSheet"&&S.then(function(R){u=f.after("default",R,function(k,T){const t=b?.message;if(!t){console.warn("[QuoteCard] No message found in action sheet data.");return}const d=m.findInReactTree(T,function(e){return Array.isArray(e)&&e.every(function(l){return l?.type===c})});if(!d){console.warn("[QuoteCard] Couldn't find action sheet buttons.");return}if(d.some(function(e){return e?.props?.label==="Quote Message"}))return;const U=async function(){try{console.log("[QuoteCard] sendQuote triggered.");const e=t.author||y.getUser(t.author?.id),l=new Date(t.timestamp).toISOString(),B={text:t.content,username:e?.username??"Unknown",timestamp:l,avatarUrl:`https://cdn.discordapp.com/avatars/${e?.id}/${e?.avatar}.png?size=256`};console.log("[QuoteCard] Sending request to card API...");const g=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)});if(!g.ok)throw new Error(`Card API failed with status ${g.status}`);const E=await g.blob(),a=new FileReader;a.onloadend=async function(){const r=a.result?.split(",")[1];if(!r)throw new Error("Base64 conversion failed.");const L=[{item:{uri:`data:image/png;base64,${r}`,filename:"quote.png",mimeType:"image/png",isImage:!0}}];console.log("[QuoteCard] Uploading image using uploadLocalFiles..."),await w([{channelId:t.channel_id,items:L,token:C,parsedMessage:{content:""}}]),i.showToast("\u2705 Quote sent!"),console.log("[QuoteCard] Upload success.")},a.onerror=function(r){console.error("[QuoteCard] FileReader error",r),i.showToast("\u274C Error reading image")},a.readAsDataURL(E)}catch(e){console.error("[QuoteCard] Error:",e),i.showToast("\u274C Quote generation failed")}finally{h.hideActionSheet()}};d.push(o.React.createElement(c,{label:"Quote Message",icon:o.React.createElement(c.Icon,{source:p.getAssetIDByName("ic_message"),IconComponent:function(){return o.React.createElement(o.ReactNative.Image,{style:{width:24,height:24},source:p.getAssetIDByName("ic_message")})}}),onPress:U})),console.log("[QuoteCard] Quote Message button injected.")})})})}function Q(){u&&u()}var A={onLoad:v,onUnload:Q};return s.default=A,Object.defineProperty(s,"__esModule",{value:!0}),s})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils);
