(function(c,a,s,g,f,n,v){"use strict";const h=a.findByProps("openLazy","hideActionSheet"),u=a.findByProps("ActionSheetRow")?.ActionSheetRow,w=a.findByStoreName("MessageStore"),S=a.findByStoreName("UserStore");let p;const C=function(){p?.()};function _(){p=g.after("openLazy",h,function(I){let[P,T,m]=I;T==="MessageLongPressActionSheet"&&P.then(function(M){g.after("default",M,function(N,R){const r=v.findInReactTree(R,function(e){return Array.isArray(e)&&e.some(function(o){return o?.type===u})});if(!r||r.some(function(e){return e?.props?.label==="Quote Message"}))return;const B=Math.max(r.findIndex(function(e){return e?.props?.label==="Copy Text"}),1),E=async function(){try{const e=m?.message?.id,o=m?.message?.channel_id;if(!e||!o){n.showToast("\u274C Failed to locate message");return}const t=w.getMessage(o,e);if(!t){n.showToast("\u274C Could not fetch message content");return}const d=t.author??S.getUser(t.author?.id),U=new Date(t.timestamp).toISOString(),x={text:t.content.replace(/[\p{Emoji_Presentation}\p{Extended_Pictographic}]/gu,""),username:d?.username??"Unknown",timestamp:U,avatarUrl:`https://cdn.discordapp.com/avatars/${d?.id}/${d?.avatar}.png?size=4096`},l=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!l.ok){n.showToast("\u274C Failed to generate quote"),console.error("\u274C Quote API error:",l.status);return}const y=await l.json(),i=y?.url;if(!i||typeof i!="string"){n.showToast("\u274C Invalid image URL returned"),console.error("\u274C Bad response:",y);return}const{sendMessage:L}=a.findByProps("sendMessage");L(o,{content:i,message_reference:{message_id:t.id,channel_id:o,guild_id:t.guild_id??void 0}}),n.showToast("\u2705 Quote sent!"),console.log("\u2705 Sent quote image:",i)}catch(e){n.showToast("\u274C Error sending quote"),console.error("\u274C Exception:",e)}finally{h.hideActionSheet()}};r.splice(B,0,s.React.createElement(u,{label:"Quote Message",icon:s.React.createElement(u.Icon,{source:f.getAssetIDByName("ic_message"),IconComponent:function(){return s.React.createElement(s.ReactNative.Image,{style:{width:24,height:24},source:f.getAssetIDByName("ic_message")})}}),onPress:E}))})})})}var A={onLoad:_,onUnload:C};return c.default=A,Object.defineProperty(c,"__esModule",{value:!0}),c})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils);
