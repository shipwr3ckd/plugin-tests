(function(i,t,a,u,d,l,h){"use strict";const f=t.findByProps("openLazy","hideActionSheet"),s=t.findByProps("ActionSheetRow")?.ActionSheetRow;t.findByStoreName("MessageStore");const m=t.findByStoreName("UserStore"),{uploadLocalFiles:y}=t.findByProps("uploadLocalFiles"),S=t.findByProps("getToken")?.getToken();let p,r;function w(){p=u.after("openLazy",f,function(A){let[R,T,b]=A;T==="MessageLongPressActionSheet"&&R.then(function(L){r?.(),r=u.after("default",L,function(E,B){const n=b?.message;if(!n)return;const o=h.findInReactTree(B,function(e){return Array.isArray(e)&&e.some(function(c){return c?.type===s})});if(!o||o.some(function(e){return e?.props?.label==="Quote Message"}))return;const M=Math.max(o.findIndex(function(e){return e?.props?.label==="Copy Text"}),1),P=async function(){try{const e=n.author||m.getUser(n.author?.id),c=new Date(n.timestamp).toISOString(),U={text:n.content,username:e?.username??"Unknown",timestamp:c,avatarUrl:`https://cdn.discordapp.com/avatars/${e?.id}/${e?.avatar}.png?size=256`},g=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(U)});if(!g.ok)throw new Error("Image generation failed");const F=await g.blob(),N=new File([F],"quote.png",{type:"image/png"}),k=[{item:{uri:URL.createObjectURL(N),filename:"quote.png",mimeType:"image/png",isImage:!0}}],C={content:""};await y([{channelId:n.channel_id,items:k,token:S,parsedMessage:C}]),l.showToast("\u2705 Quote sent!")}catch(e){console.error("\u274C Quote generation failed:",e),l.showToast("\u274C Failed to send quote")}finally{f.hideActionSheet()}};o.splice(M,0,a.React.createElement(s,{label:"Quote Message",icon:a.React.createElement(s.Icon,{source:d.getAssetIDByName("ic_message"),IconComponent:function(){return a.React.createElement(a.ReactNative.Image,{style:{width:24,height:24},source:d.getAssetIDByName("ic_message")})}}),onPress:P}))})})})}function v(){p?.(),r?.()}var I={onLoad(){w()},onUnload(){v()}};return i.default=I,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils);
