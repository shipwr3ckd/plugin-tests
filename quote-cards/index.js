(function(s,t,a,f,g,c,h){"use strict";const p=t.findByProps("openLazy","hideActionSheet"),d=t.findByProps("ActionSheetRow")?.ActionSheetRow;t.findByStoreName("MessageStore");const y=t.findByStoreName("UserStore"),{uploadLocalFiles:w}=t.findByProps("uploadLocalFiles"),S=t.findByProps("getToken")?.getToken();let u;function v(){return f.after("openLazy",p,function(b){let[A,R,P]=b;R==="MessageLongPressActionSheet"&&A.then(function(B){u=f.after("default",B,function(k,F){const n=P?.message;if(!n)return;const o=h.findInReactTree(F,function(e){return Array.isArray(e)&&e.some(function(l){return l?.type===d})});if(!o||o.some(function(e){return e?.props?.label==="Quote Message"}))return;const L=Math.max(o.findIndex(function(e){return e?.props?.label==="Copy Text"}),1),M=async function(){try{const e=n.author||y.getUser(n.author?.id),l=new Date(n.timestamp).toISOString(),C={text:n.content,username:e?.username??"Unknown",timestamp:l,avatarUrl:`https://cdn.discordapp.com/avatars/${e?.id}/${e?.avatar}.png?size=256`},m=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)});if(!m.ok)throw new Error("Image generation failed");const U=await m.blob(),r=new FileReader;r.onloadend=async function(){const i=r.result?.split(",")[1];if(!i)throw new Error("Failed to read image data");const E=[{item:{uri:`data:image/png;base64,${i}`,filename:"quote.png",mimeType:"image/png",isImage:!0}}],N={content:""};await w([{channelId:n.channel_id,items:E,token:S,parsedMessage:N}]),c.showToast("\u2705 Quote sent!")},r.onerror=function(i){console.error("\u274C Failed to read blob:",i),c.showToast("\u274C Failed to read image data")},r.readAsDataURL(U)}catch(e){console.error("\u274C Quote generation failed:",e),c.showToast("\u274C Failed to send quote")}finally{p.hideActionSheet()}};o.splice(L,0,a.React.createElement(d,{label:"Quote Message",icon:a.React.createElement(d.Icon,{source:g.getAssetIDByName("ic_message"),IconComponent:function(){return a.React.createElement(a.ReactNative.Image,{style:{width:24,height:24},source:g.getAssetIDByName("ic_message")})}}),onPress:M}))})})})}function I(){u&&u()}var T={onLoad:v,onUnload:I};return s.default=T,Object.defineProperty(s,"__esModule",{value:!0}),s})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils);
