(function(i,n,a,u,d,r,h){"use strict";const l=n.findByProps("openLazy","hideActionSheet"),s=n.findByProps("ActionSheetRow")?.ActionSheetRow;n.findByStoreName("MessageStore");const y=n.findByStoreName("UserStore"),w=n.findByProps("uploadLocalFiles"),{uploadLocalFiles:S}=w??{},{getToken:v}=n.findByProps("getToken");let g;function I(){return u.after("openLazy",l,function(B){let[U,P,C]=B;P==="MessageLongPressActionSheet"&&U.then(function(E){g=u.after("default",E,function(_,M){const t=C?.message;if(!t)return;const o=h.findInReactTree(M,function(e){return Array.isArray(e)&&e.some(function(c){return c?.type===s})});if(!o||o.some(function(e){return e?.props?.label==="Quote Message"}))return;const N=Math.max(o.findIndex(function(e){return e?.props?.label==="Copy Text"}),1),R=async function(){try{const e=t.author??y.getUser(t.author?.id),c=new Date(t.timestamp).toISOString(),b={text:t.content,username:e?.username??"Unknown",timestamp:c,avatarUrl:`https://cdn.discordapp.com/avatars/${e?.id}/${e?.avatar}.png?size=256`};r.showToast("\u2699\uFE0F Generating quote...");const f=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!f.ok)throw new Error("Failed to generate image");const q=await f.arrayBuffer(),k=Array.from(new Uint8Array(q)).map(function(L){return String.fromCharCode(L)}).join(""),p=`data:image/png;base64,${btoa(k)}`,m={uri:p,filename:"quote.png",mimeType:"image/png",width:500,height:200,id:`${Date.now()}`,platform:0,origin:1},F=v();console.log("\u2705 Uploading quote.png..."),r.showToast("\u{1F4E4} Uploading quote..."),S?.({channelId:t.channel_id,parsedMessage:{content:"",tts:!1,invalidEmojis:[],validNonShortcutEmojis:[]},items:[{item:m,isImage:!0,isVideo:!1,filename:"quote.png",mimeType:"image/png",id:m.id,uri:p,channelId:t.channel_id}],token:F})}catch(e){console.error("\u274C Quote generation error:",e),r.showToast("\u274C Quote generation failed")}finally{l.hideActionSheet()}};o.splice(N,0,a.React.createElement(s,{label:"Quote Message",icon:a.React.createElement(s.Icon,{source:d.getAssetIDByName("ic_message"),IconComponent:function(){return a.React.createElement(a.ReactNative.Image,{style:{width:24,height:24},source:d.getAssetIDByName("ic_message")})}}),onPress:R}))})})})}function T(){g?.()}var A={onLoad:I,onUnload:T};return i.default=A,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.ui.toasts,vendetta.utils);
