(function(r,n,a,d,u,g){"use strict";const f=n.findByProps("openLazy","hideActionSheet"),i=n.findByProps("ActionSheetRow")?.ActionSheetRow,y=n.findByStoreName("MessageStore"),m=n.findByStoreName("UserStore");let l;const S=function(){l?.()};function v(){l=d.after("openLazy",f,function(M){let[P,A]=M;A==="MessageLongPressActionSheet"&&P.then(function(b){d.after("default",b,function(w,I){let[R]=w;const o=g.findInReactTree(I,function(e){return Array.isArray(e)&&e.some(function(t){return t?.type===i})});if(!o||o.some(function(e){return e?.props?.label==="Quote Message"}))return;const B=Math.max(o.findIndex(function(e){return e?.props?.label==="Copy Text"}),1),p="ic_chat_bubble_24px";o.splice(B,0,a.React.createElement(i,{label:"Quote Message",icon:a.React.createElement(i.Icon,{source:u.getAssetIDByName(p),IconComponent:function(){return a.React.createElement(a.ReactNative.Image,{style:{width:24,height:24},source:u.getAssetIDByName(p)})}}),onPress:async function(){try{const{message:e}=R;if(!e?.id||!e?.channel_id)return;const t=y.getMessage(e.channel_id,e.id);if(!t)return;const s=t.author??m.getUser(t.author?.id),x={text:t.content.replace(/[\p{Emoji_Presentation}\p{Extended_Pictographic}]/gu,""),username:s?.username??"Unknown",timestamp:new Date(t.timestamp).toISOString(),avatarUrl:`https://cdn.discordapp.com/avatars/${s?.id}/${s?.avatar}.png?size=4096`},h=await fetch("https://quote-cardgen.onrender.com/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!h.ok)return;const c=(await h.json())?.url;if(!c||typeof c!="string")return;const{sendMessage:E}=n.findByProps("sendMessage");E(e.channel_id,{content:c})}catch(e){console.error("Quote error",e)}finally{f.hideActionSheet()}}}))})})})}var _={onLoad:v,onUnload:S};return r.default=_,Object.defineProperty(r,"__esModule",{value:!0}),r})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.assets,vendetta.utils);
